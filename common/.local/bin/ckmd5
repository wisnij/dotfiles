#!/bin/bash
# Check all .checksums.md5 under the given path(s), or the current directory

errors=false
while IFS= read -r dir; do
    if ! (cd "$dir"; pwd; nice ionice -c3 md5sum -c .checksums.md5); then
        errors=true
    fi
done < <(find "$@" -name .checksums.md5 -printf '%h\n' | sort)

if $errors; then
    exit 1
fi
