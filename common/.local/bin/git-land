#!/bin/bash
# Squash merge a feature branch onto master

set -eu

branch=''
if [[ $# -gt 0 ]]; then
    branch=$1
    shift
fi

master='master'
if git show-ref --verify --quiet refs/heads/main; then
    master='main'
fi

if [[ -z $branch ]]; then
    branch=$(git branch --show-current)
fi

if [[ $branch == $master ]]; then
    echo "Already on '$branch'" >&2
    exit 1
fi

set -x
git checkout $master
git merge --squash --ff "$@" "$branch"
