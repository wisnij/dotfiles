#!/bin/bash
# NordVPN wrapper script
set -eu -o pipefail

NORMAL=$'\e[0m'
BRIGHT=$'\e[1m'
RED=$'\e[31m'
GREEN=$'\e[32m'

colorize () {
    while IFS= read -r line; do
        line=${line##*$'\r'}
        k=${line%%: *}
        v=${line##*: }
        if [[ $v == "enabled" || $v == "Connected" ]]; then
            v="${GREEN}$v${NORMAL}"
        elif [[ $v == "disabled" || $v == "Disconnected" ]]; then
            v="${RED}$v${NORMAL}"
        fi
        echo "${BRIGHT}$k${NORMAL}: $v"
    done
}

status () {
    nordvpn status | colorize
    echo
    nordvpn settings | colorize
}

if [[ $# -lt 1 ]]; then
    date
    status
    exit
fi

cmd=$1
shift

case $cmd in
    d | disconnect)
        nordvpn set killswitch 0
        ;;
esac

nordvpn "$cmd" "$@"

case $cmd in
    c | connect)
        nordvpn set killswitch 1
        echo
        status
        ;;
esac
